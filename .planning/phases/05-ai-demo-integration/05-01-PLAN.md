# Plan 05-01: Interactive Demo Architecture & UI Framework

## Objective

Build a complete frontend framework for the interactive AI demo that can operate in simulated mode now and connect to a real backend later. Create the voice/chat hybrid component architecture with visible tool calls, streaming transcripts, and all necessary state visualizations.

This plan focuses on **what we can build without the backend decision**, establishing clear interfaces for future integration.

## Execution Context

**Phase**: 5 — AI Demo Integration
**Scope**: Medium-Large (10 tasks)
**Dependencies**: Phase 4 animation components (ThinkingState, StateTransition, Waveform, etc.)

**Key Files to Modify:**
- `src/components/VoiceDemo.jsx` — Refactor to use new demo architecture
- `src/components/demo/` — New directory for demo-specific components

**Reference:**
- `.planning/codebase/ARCHITECTURE.md` — Current component patterns
- `src/components/animations/` — Existing animation components to reuse

## Context

### Current State
- VoiceDemo.jsx has simulated state cycling (idle → listening → processing → responding)
- Animation components exist: ThinkingState, ProgressIndicator, StateTransition, Waveform
- Demo shows pre-written transcripts with fake state changes
- No real interaction possible

### Target State
- Interactive demo components with clear state machine
- Visible tool call visualization (shows what the AI is doing)
- Streaming conversation transcript
- Hybrid flow: watches simulated demo → can interact with real agent
- Error, timeout, and fallback states handled gracefully
- Backend-agnostic architecture (mock now, real later)

### Design Constraints
- **Brutalist aesthetic**: Hard shadows, no blur, functional motion only
- **Reduced motion support**: All animations must respect prefers-reduced-motion
- **No backend coupling**: Use dependency injection for connection layer
- **Progressive enhancement**: Works as simulated demo even if backend unavailable

## Tasks

### 1. Create demo component architecture documentation
**Commit scope**: docs only

Create `src/components/demo/ARCHITECTURE.md` documenting:
- State machine: `idle` → `simulated` → `interactive` → `{listening, processing, responding}` → `complete/error`
- Component hierarchy: DemoController → DemoAgent → {ToolCallDisplay, ConversationTranscript}
- API interface for backend connection (what methods the hook must implement)
- Event flow diagram

**Files**: `src/components/demo/ARCHITECTURE.md`

---

### 2. Create useDemoState hook
**Commit scope**: new hook

Finite state machine hook for demo flow:
```js
const { state, send, context } = useDemoState();
// state: 'idle' | 'simulated' | 'interactive' | 'listening' | 'processing' | 'responding' | 'error' | 'timeout'
// send: (event) => void — dispatch state transitions
// context: { messages, currentToolCall, error, ... }
```

Uses useReducer for predictable state transitions. No external dependencies.

**Files**: `src/hooks/useDemoState.js`

---

### 3. Create ToolCallDisplay component
**Commit scope**: new component

Visualizes AI tool calls transparently:
- Tool name with icon
- Parameters (collapsible)
- Status: pending → executing → complete/failed
- Uses existing animation components for transitions

Props: `{ toolName, params, status, onComplete }`

**Files**: `src/components/demo/ToolCallDisplay.jsx`

---

### 4. Create ConversationTranscript component
**Commit scope**: new component

Streaming conversation display:
- Message bubbles (user vs AI distinguished by accent color)
- Streaming text effect for AI responses
- Timestamp display (optional)
- Auto-scroll to latest message
- Uses brutalist styling (no rounded corners, hard shadows)

Props: `{ messages, isStreaming, streamingText }`

**Files**: `src/components/demo/ConversationTranscript.jsx`

---

### 5. Create DemoError and DemoFallback components
**Commit scope**: new components

Error states for demo failures:
- **DemoError**: Connection failed, API error, etc. Shows retry option.
- **DemoFallback**: Backend unavailable, falls back to simulated mode with explanation.
- **DemoTimeout**: Response taking too long, shows cancel option.

All use StateTransition for animated appearance.

**Files**:
- `src/components/demo/DemoError.jsx`
- `src/components/demo/DemoFallback.jsx`
- `src/components/demo/DemoTimeout.jsx`

---

### 6. Create useDemoConnection hook (mock implementation)
**Commit scope**: new hook

Abstracted connection interface that can be swapped for real backend later:
```js
const { connect, disconnect, send, status, messages } = useDemoConnection({
  mode: 'mock', // 'mock' | 'websocket' | 'polling'
  onMessage, onError, onToolCall
});
```

Mock mode simulates realistic delays and tool calls. Interface designed for WebSocket or polling implementation later.

**Files**: `src/hooks/useDemoConnection.js`

---

### 7. Create DemoAgent component
**Commit scope**: new component

Main interactive agent card (replaces current static cards):
- Header: Agent name, type (Revenue/Service), status indicator
- Waveform visualization (reuse existing component)
- Tool call display area (collapsible)
- Transcript area with streaming support
- Input area (microphone button + text input toggle)
- Uses ThinkingState during processing

Props: `{ agentType, agentName, connection, onInteractionStart }`

**Files**: `src/components/demo/DemoAgent.jsx`

---

### 8. Create DemoController component
**Commit scope**: new component

Manages the hybrid demo flow:
1. **Simulated phase**: Auto-plays scripted conversation (current behavior)
2. **Transition prompt**: "Want to try it yourself?" CTA
3. **Interactive phase**: Real input/output with connection hook
4. Handles mode switching and state coordination between agents

Props: `{ autoStart, onModeChange }`

**Files**: `src/components/demo/DemoController.jsx`

---

### 9. Create demo component index and refactor VoiceDemo
**Commit scope**: integration

- Create `src/components/demo/index.js` exporting all demo components
- Refactor VoiceDemo.jsx to use DemoController with two DemoAgent cards
- Maintain current visual design while using new interactive architecture
- Keep section header and CTA unchanged

**Files**:
- `src/components/demo/index.js`
- `src/components/VoiceDemo.jsx`

---

### 10. Build and lint verification
**Commit scope**: fixes only

- Run `npm run build` and `npm run lint`
- Fix any errors or warnings
- Verify demo still displays correctly in simulated mode

**Files**: As needed for fixes

---

## Verification

```bash
# All checks must pass
npm run lint
npm run build

# Manual verification
npm run dev
# - Navigate to demo section
# - Verify simulated demo plays automatically
# - Verify tool call display appears during "processing" state
# - Verify transition prompt appears after simulated demo
# - Verify error fallback displays gracefully if connection fails
# - Test with prefers-reduced-motion enabled
```

## Success Criteria

- [ ] Demo architecture documented with clear state machine
- [ ] All demo components created and exported
- [ ] useDemoState hook manages all state transitions
- [ ] useDemoConnection hook has working mock implementation
- [ ] ToolCallDisplay shows transparent AI operations
- [ ] ConversationTranscript supports streaming text
- [ ] Error/timeout/fallback states display gracefully
- [ ] VoiceDemo refactored to use new architecture
- [ ] Simulated demo works identically to before
- [ ] Interactive mode shell ready for backend connection
- [ ] All animations respect prefers-reduced-motion
- [ ] Build and lint pass with no errors

## Output

On completion, create `05-01-SUMMARY.md` with:
- Tasks completed with commit hashes
- Component inventory (what was created)
- API interface documentation for backend integration
- Any deviations from plan
- Recommended next steps (backend decision points)

## Notes

### Backend Decision Points (for future 05-02 plan)
This plan intentionally defers these decisions:
- WebSocket vs polling for real-time updates
- Voice API integration (Web Speech API vs cloud service)
- Authentication for demo usage
- Rate limiting and abuse prevention

### Architecture Decisions Made
- **State machine over ad-hoc state**: Predictable transitions, easier debugging
- **Dependency injection for connection**: Swap mock for real without component changes
- **Streaming-first transcript**: Handles both simulated and real responses consistently
- **Visible tool calls**: Differentiator for "AI-native" experience

---
*Created: 2026-01-12*
